<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /> 
  
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css" />
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojox/form/resources/CheckedMultiSelect.css" />

  <style type="text/css">
.datetime {
  border: 1px solid #759dc0;
  background: white;
  display: inline-block;
  width: auto;
  vertical-align: middle;
}

.datetime > .dijitDateTextBox {
  border: none;
  padding-left: .25em;
  width: 10em;
}

.datetime > .dijitDateTextBox > .dijitButtonNode {
  border: none;
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAABp0lEQVQ4y43TP2hTcRAH8E/CI4QGRKSGugkiooNUhYh9k6i4COIah4JDFkclKthFUfHFvRBQqEMGQR2LoHaKfzKo7dBRFBxEHByaIkGiyz14hoIe/Ljffe9+x9337lcyIWkrW8UBpP1ue1DAP6OOI/1uez3HS2krq+AyjuEWlrEd53AeU7iG1XhzHJfwGvcSLOJCOO9PFHQyknUm8DNx9iRoFhyHcBN78Q3bAp/FAnZNJGqWUS0A13EKO/AU5cA7OIppPC7EV5O4vIpTlIe2lgeh5zCXJ1jAGxzEZr/bXktbWYLDGOPdcNAb1xrNWVSwFglelNJW9juYPY2rkXA/GlgK+yy+4m3YVzDASrnYz8R90p7aKjYpgEv4iSHW8R23w/cyfDeihUeY+SvBcND7UGs0P2HU77ZH+JK2srsY97vtjdjGDpLhoPej1mjO5JuYczAXmzjCviAwH9mJqOh9jPZiVLlSbGFn6EpsX73gq8c0cs6mixyMQy9jNzbxEb/wJOIG2IjeK3gepI5LaSvrB0F34tH/SBIfrJpgPibwrFDiv2Qcizf/B6rfbiV80qpEAAAAAElFTkSuQmCC);
  background-color: transparent;
  background-repeat: no-repeat;
  background-position: center;
  width: 22px;
  height: 22px;
}

.datetime > .dijitDateTextBox > .dijitButtonNode > .dijitArrowButtonInner,
.datetime > .dijitTimeTextBox > .dijitButtonNode > .dijitArrowButtonInner {
  display: none;
}

.datetime > .dijitTimeTextBox {
  border: none;
  padding-left: .25em;
  width: 5em;
}

.datetime > .dijitTimeTextBox > .dijitArrowButton {
  border: none;
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9ElEQVQ4y7WVP2gUQRTGf1mWrSSIEYuUqcTqPAiIf1aCzXkowTKt0wSzTYoUB8oRPEhxRZpRYjGWkjZNuEaEASHVkTqF5SFyhJBKDjnSfIOTIXeXQl/1dt5737739ptv55hiZeXmgTqwqKMB0PfWnE+qmZsA9ABoAQ2gSMIjoAfseGuOpgKWlSuAXeBNdDwGhvJvA1l0vgdsemtGITlLwA4isGNgDVgAngMv5a8plin3QLWXAdVZQ34HWPbW7HtrzoAaUPfWnHlr9oFl5aCa3Usja2ff9YKOt+Yd17Cycu+Btxr/kbfmKFesJbBjoD0D5B6wCWwA28ALTdACVjNRI4za9daMo+LHZeXuJGBfgYdA5q35A3TD6GXl5nPxrFDbh0lDn4C8rNwKcFNgp8Azb81v5RyqtgDqWUTaIbBUVm49AnwF3AC+JWA/1fFr4G5Eq8Vs2r68NSfAikAHwNMAlvCUmDaDiLQ/vDV7V4DeB554a4ZJ7DNwolqAQQ70dZ0KoAl8uaLTX1MGaaqxEdDPdNF7Cm6Vlcu5pil3S489b8152OGOdlGbxcPE2qoZC+OvOJSV+xDd4w6wLZ6Fr1mE/aqztm4JwEdvzUYKGMShEYlDVzxbAnJ9gKbGrIVRgdWgOJPkaz2RqVP5t2bJ1/8V2H/xC7gA3Mu8RLBms9sAAAAASUVORK5CYII%3D);
  background-color: transparent;
  background-repeat: no-repeat;
  background-position: center;
  width: 22px;
  height: 22px;
}

.datetime > .timezone {
  display: inline-block;
  height: 22px;
  width: 2em;
  padding-left: .25em;
}

.datetime > .dijitTimeTextBox > .dijitInputContainer > span.dijitPlaceHolder {
  padding-top: 2px;
}

.durationHour {
  width: 4.25em;
}
.durationMinute {
  width: 3.25em;
}

/*
.durationHour::after { 
      content: "h";
}
.durationMinute::after { 
      content: "m";
}
*/
  </style>

  <script>
var dojoConfig = {
  async: true, 
  debug: true,
//   gfxRenderer: "svg",
  packages: [{
    name: 'dstore',
    location: 'http://cdn.rawgit.com/SitePen/dstore/v1.0.0'
  }, {
    name: 'dmodel',
    location: 'http://cdn.rawgit.com/SitePen/dmodel/master'
  }, {
    name: 'moment',
    location: 'http://cdn.rawgit.com/moment/moment/2.7.0',
    main: 'moment'
  }, {
    name: 'moment-timezone',
    location: 'http://cdn.rawgit.com/moment/moment-timezone/0.0.1'
  }]
};
  </script>

  <script src='http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js'></script>

  <script>

  require([
  "dojo/_base/declare",
  "dojo/on",
  "dojo/dom",
  "dojo/dom-construct",
  "dojo/parser",
  "dijit/registry",
  "dojox/form/CheckedMultiSelect",
  "dojo/date",
  "dstore/Memory",
  "dstore/Trackable",
  "dstore/legacy/DstoreAdapter",
  "dmodel/Model",
  "dmodel/ComputedProperty",
  "moment/moment",
  "moment-timezone/moment-timezone",
  "dojo/domReady!",

  "dijit/MenuBar",
  "dijit/PopupMenuBarItem",
  "dijit/Menu",
  "dijit/MenuItem",
  "dijit/MenuBarItem",
  "dijit/DropDownMenu",
  "dijit/CheckedMenuItem",
  "dijit/Dialog",
  "dijit/form/Form",
  "dijit/form/CheckBox",
  "dijit/form/TextBox",
  "dijit/form/Button",
  "dijit/form/DateTextBox",
  "dijit/form/TimeTextBox",
  "dijit/form/NumberTextBox",
  "dijit/form/FilteringSelect",
  "dijit/form/NumberSpinner",
  "dijit/layout/TabContainer", 
  "dijit/layout/ContentPane", 
  "dojox/layout/TableContainer",
  "dijit/form/Select"

//  "https://cdn.rawgit.com/moment/moment/2.7.0/moment.js",
//  "https://cdn.rawgit.com/moment/moment-timezone/0.0.1/moment-timezone.js"
], function(
  declare,
  on, 
  dom, 
  domConstruct, 
  parser, 
  registry, 
  CheckedMultiSelect,
  date,
  Memory,
  Trackable,
  DstoreAdapter,
  Model,
  ComputedProperty,
  Moment,
  Timezone
  ){

  // ===============================================
  // Fix to support reset on CheckedMultiSelect.
  // ===============================================
  // source: http://jsfiddle.net/FNL3h/
  FixedCheckedMultiSelect = declare("dojox/form/FixedCheckedMultiSelect", [ CheckedMultiSelect ], {
    reset: function() {
      this.inherited(arguments);
      if (!this._resetValue || !this._resetValue.length) {
        this._updateSelection();
      }
    },
    //displayMessage : function(){}, // to disable message "At least one item must be selected".
    validator: function() {
      console.log('je passe dans validator...');
      if (!this.required){
        return true;
      }
      return this.value.length > 0 ? true : false; 
    },
  });
  
/*
  FixedTimeZone = declare("dojox/date/timezone", [ TimeZone ], {
    loadZoneFile: function(/* String  fileName){
    // summary:
    //fileNameLoads the given URL of the Olson zone information into the
    //intozone database
    //
    // fileName: String
    //fileName:The zoneinfo file name to load

    // TODO: Maybe behave similar to requireLocalization - rather than
    //ratherUsing request.get?
    _loadedZones[fileName] = true;
    request.get(require.toUrl((config.timezoneFileBasePath || "dojox/date/zoneinfo") + "/" + fileName), {
      handleAs: "olson_zoneinfo",
      sync: true, 
      headers: {
        "X-Requested-With": null
      }
      }).then(loadZoneData, function(e){
      console.error("Error loading zone file:", e);
      throw e;
    });
  },
  });
*/

  parser.parse();


  // ===============================================
  // Resize graph size
  // ===============================================

  // set the right height of the object holding the svg graph. for unknown reason, the width works well 
  // with 100%, but not the height. So it needs to be evaluated each time the window size changes.
  function browserResize(){
    // the 8 comes from the margin (2 times) value on body, and margin-bottom (one time) on id navMenu.
    dom.byId("graph").height = window.innerHeight - 3 * 8 - dom.byId("navMenu").offsetHeight;
  }


  // on window change, update the size of the svg graph.
  if (window.addEventListener) {              
    window.addEventListener("resize", browserResize);
  } else if (window.attachEvent) {                 
    window.attachEvent("onresize", browserResize);
  }
  browserResize();

  // ===============================================
  // Start Date Time + duration Hour Minute => 
  // End Date Time (readonly).
  // ===============================================
  function UpdateEndDateTime(prefixId){
  
    var mytime = registry.byId(prefixId + "StartTime").get("value");
    var mydate = registry.byId(prefixId + "StartDate").get("value");

    var year   = mydate.getFullYear(),
        month  = mydate.getMonth(),
        day    = mydate.getDate(),
        hour   = mytime.getHours(),
        minute = mytime.getMinutes();

    var mydatetime = new Date(year, month, day, hour, minute);
    hour = registry.byId(prefixId + "DurationHour").value;
    mydatetime = date.add(mydatetime, "hour", hour);
    minute = registry.byId(prefixId + "DurationMinute").value;
    mydatetime = date.add(mydatetime, "minute", minute);

    registry.byId(prefixId + "EndDate").set('value', mydatetime);
    registry.byId(prefixId + "EndTime").set('value', mydatetime);
  } 

  // ===============================================
  // SVG drawing
  // ===============================================

  // Assumption on the SVG:
  // - One pixel per minute, so a day is 1440px width.
  // - Group node (g) is generally used to be able to shift concept in the 
  //   right position, so drawing the inner concept is logically simpler.
  //
  // An attempt to use dojox.gfx module to draw SVG was done, but some problems 
  // occured to identify existing node, in order to add new objects.

  var svg     = dom.byId("graph").getSVGDocument();
  var svgNS   = "http://www.w3.org/2000/svg";
  var xlinkNS = "http://www.w3.org/1999/xlink";

  // Draw a calendar date. The drawing belongs to id calendar in the SVG.
  // Each "date" is embedded in a g node, with a translation on X, according
  // to the position. This way, each drawing into the g node is strictly the 
  // same for each day, except labels.
  function SVG_drawCalendarDate(item){
    var calendarId    = svg.getElementById("calendar");
    var calendarBarId = svg.getElementById("calendar_bar");

    var G       = document.createElementNS(svgNS, "g");
    G.setAttributeNS(null, "transform", "translate(" + 1440 * item.get('position') + ",0)");
    //G.setAttributeNS(null, "class", item.get('type'));
    G.setAttributeNS(null, "id", item.get('ident'));
    calendarId.appendChild(G);


    var TextRelativeDate = document.createElementNS(svgNS, "text");
    TextRelativeDate.setAttributeNS(null, "class", "day_label relative");
    TextRelativeDate.setAttributeNS(null, "x", 720);
    TextRelativeDate.setAttributeNS(null, "y", -70);
    G.appendChild(TextRelativeDate);

    var TextNodeRelativeDate = document.createTextNode("Day " + item.get('relative') );
    TextRelativeDate.appendChild(TextNodeRelativeDate);

    var TextYYYYMMDDDate = document.createElementNS(svgNS, "text");
    TextYYYYMMDDDate.setAttributeNS(null, "class", "day_label yyyymmdd");
    TextYYYYMMDDDate.setAttributeNS(null, "x", 720);
    TextYYYYMMDDDate.setAttributeNS(null, "y", -20);
    G.appendChild(TextYYYYMMDDDate);
    
    var TextNodeYYYYMMDDDate = document.createTextNode(item.get('name'));
    TextYYYYMMDDDate.appendChild(TextNodeYYYYMMDDDate);

    var UseHourLabel = document.createElementNS(svgNS, "use");
    UseHourLabel.setAttributeNS(xlinkNS, 'href', "#hour_labels");
    G.appendChild(UseHourLabel);


    var Gbar     = document.createElementNS(svgNS, "g");
    Gbar.setAttributeNS(null, "transform", "translate(" + 1440 * item.get('position') + ",0)");
    Gbar.setAttributeNS(null, "class", item.get('type'));
    Gbar.setAttributeNS(null, "id", "bar_" + item.get('ident'));
    calendarBarId.appendChild(Gbar);

    var UseDay = document.createElementNS(svgNS, "use");
    UseDay.setAttributeNS(xlinkNS, 'href', "#day");
    Gbar.appendChild(UseDay);

    var UseHours = document.createElementNS(svgNS, "use");
    UseHours.setAttributeNS(xlinkNS, 'href', "#hours");
    Gbar.appendChild(UseHours);
  }

  // Draw a crewmember. The drawing is embedded into a g node 
  // with a translation on y, and belongs to crewmembers id.
  // There is no x translation, so every activity attached to the 
  // crewmember will be add into the g node.
  function SVG_drawCrewMember(item){
    var crewMemberId    = svg.getElementById("crewmembers");
    var crewMemberBarId = svg.getElementById("crewmember_bar");

    var G = document.createElementNS(svgNS, "g");
    G.setAttributeNS(null,"transform","translate(0, " + item.get('y') + ")");
    G.setAttributeNS(null,"id", item.get('ident'));
    crewMemberId.appendChild(G);

    var TextName = document.createElementNS(svgNS, "text");
    TextName.setAttributeNS(null, "class", "crewmember");
    TextName.setAttributeNS(null, "x", -50);
    TextName.setAttributeNS(null, "y", 100);
    G.appendChild(TextName);

    var TextNodeName = document.createTextNode(item.get('name'));
    TextName.appendChild(TextNodeName);

    
    var Gbar = document.createElementNS(svgNS, "g");
    Gbar.setAttributeNS(null,"transform","translate(0, " + item.get('y') + ")");
    Gbar.setAttributeNS(null,"id", "bar_" + item.get('ident'));
    crewMemberBarId.appendChild(Gbar);

    var Rect1 = document.createElementNS(svgNS, "rect");
    Rect1.setAttributeNS(null, "class", "line");
    Rect1.setAttributeNS(null, "x", 0);
    Rect1.setAttributeNS(null, "y", 0);
    Rect1.setAttributeNS(null, "width", 1);
    Rect1.setAttributeNS(null, "height", 1);
    Gbar.appendChild(Rect1);
   
    var Rect2 = document.createElementNS(svgNS, "rect");
    Rect2.setAttributeNS(null, "class", "line");
    Rect2.setAttributeNS(null, "x", 0);
    Rect2.setAttributeNS(null, "y", 200);
    Rect2.setAttributeNS(null, "width", 1);
    Rect2.setAttributeNS(null, "height", 1);
    Gbar.appendChild(Rect2);
  }

  // Draw a rectangle that modelizes a transportation time or a rest.
  function SVG_drawRect(type, x, y, width){
    var Rect = document.createElementNS(svgNS,"rect");
    Rect.setAttributeNS(null, "class", type);
    Rect.setAttributeNS(null, "x", x);
    Rect.setAttributeNS(null, "y", y);
    Rect.setAttributeNS(null, "width", width);
    Rect.setAttributeNS(null, "height", 30);
    return Rect;
  }
  
  // Draw an activity. As the others, the drawing is embedded into a g node 
  // with a translation on y, and belongs to crewmember or opentime line.
  // Therefore no y translation is necessary, a x is used to draw the activity on
  // the rigth place in the calendar.
  function SVG_drawActivity(activity, line){

    var parentId = svg.getElementById(line.get('ident'));

    var G = document.createElementNS(svgNS, "g");
    G.setAttributeNS(null, "transform", "translate(" + activity.get('x') + ",50)");
    G.setAttributeNS(null, "id", activity.get('ident'));
    G.setAttributeNS(null, "onclick", "alert('can display details here');");
    parentId.appendChild(G);

    var Rect = document.createElementNS(svgNS,"rect");
    Rect.setAttributeNS(null, "class", activity.get('type'));
    Rect.setAttributeNS(null, "x", 0);
    Rect.setAttributeNS(null, "y", 0);
    Rect.setAttributeNS(null, "rx", 20);
    Rect.setAttributeNS(null, "ry", 20);
    Rect.setAttributeNS(null, "width", activity.get('width'));
    Rect.setAttributeNS(null, "height", 100);
    G.appendChild(Rect);

    var Text = document.createElementNS(svgNS,"text");
    Text.setAttributeNS(null, "class", "label");
    Text.setAttributeNS(null, "x", 10);
    Text.setAttributeNS(null, "y", 50);
    Text.setAttributeNS(null, "font-size", 50);
    Text.setAttributeNS(null, "text-anchor", "start");
    G.appendChild(Text);

    var TextNode = document.createTextNode(activity.get('name'));
    Text.appendChild(TextNode);

    // transporation time
    if( activity.get('tp') > 0 ){
      // before.
      G.appendChild(SVG_drawRect("TP", activity.get('tp') * -1, 20, activity.get('tp')));

      // after.
      G.appendChild(SVG_drawRect("TP", activity.get('width') * -1, 50, activity.get('tp')));
    }

    // rest before
    if( activity.get('restb') > 0 ){
      G.appendChild(SVG_drawRect("REST", (activity.get('restb') + activity.get('tp') ) * -1, 20, activity.get('restb')));
    }
    
    // rest after. 
    if( activity.get('resta') > 0 ){
      G.appendChild(SVG_drawRect("REST", activity.get('width') + activity.get('tp'), 50, activity.get('resta')));
    }

  }

  // ===============================================
  // Data MODELs
  // ===============================================

  var TrackableMemory = declare([Memory, Trackable]);

  var CalendarModel = declare(Model, {
    schema: {
      name: 'string',
      relative: 'numeric',
      position: 'numeric',
      type: new ComputedProperty({
        dependsOn: ['position'],
        getValue: function(position){
          return position % 2 ? "uneven" : "even";
        }
      }),
      ident: new ComputedProperty({ 
        dependsOn: ['position'],
        getValue: function(position){
          return "cd" + position;  // cd stands for Calendar Day.
        }
      }),
    },
    validateOnSet: false
  });

  var CrewMemberModel = declare(Model, {
    schema: {
      name: 'string',
      birthdate: 'string',
      position: 'numeric',
      ident: new ComputedProperty({ 
        dependsOn: ['position'],
        getValue: function(position){
          return "cm" + position; // cm stands for CrewMember.
        }
      }),
      y: 'numeric',
      height: 'numeric',
    },
    validateOnSet: false
  });

  var ActivityModel = declare(Model, {
    schema: {
      name: 'string',
      position: 'numeric',
      x: 'numeric',
      width: 'numeric',
      tp: 'numeric',
      resta: 'numeric',
      restb: 'numeric',
      type: 'string',
      cmPosition: 'numeric', // foreign key to CrewMember.
      ident: new ComputedProperty({ 
        dependsOn: ['position', 'type'],
        getValue: function(position, type){
          return type.toLowerCase() + position;  // DOxxx or TRPxxx or  .. 
        }
      }),
    },
    validateOnSet: false
  });
 
  var StationModel = declare(Model, {
    schema: {
      id: 'string',
      code: 'string',
      name: 'string',
      dstShift: 'string',
      dstStartLst: 'string',
      dstEndLst: 'string',
      utcOffset: 'string',
      regionList: 'array',
    },
    validateOnSet: false
  });

  // ===============================================
  // Data STOREs and events.
  // ===============================================

  // -----------------------------------------------
  // calendarStore
  // -----------------------------------------------
  var calendarStore = new TrackableMemory({
    Model: CalendarModel,
    idProperty: "position",
  });

  calendarStore.on('add', function(event){
    SVG_drawCalendarDate(event.target);
  });

  calendarStore.on('update', function(event){
    var item  = svg.getElementById(event.target.get('ident'));
    var item2 = svg.getElementById("bar_" + event.target.get('ident'));
    
    item.parentNode.removeChild(item);
    item2.parentNode.removeChild(item2);

    SVG_drawCalendarDate(event.target);
  });

  calendarStore.on('delete', function(event){
    var item  = svg.getElementById(event.target.get('ident'));
    var item2 = svg.getElementById("bar_" + event.target.get('ident'));
    
    item.parentNode.removeChild(item);
    item2.parentNode.removeChild(item2);
  });

  var calendarStoreAdapter = new DstoreAdapter(calendarStore);
  registry.byId("CalendarStartPeriods").set("labelAttr", "name");
  registry.byId("CalendarStartPeriods").setStore(calendarStoreAdapter);
  registry.byId("DayOffDatesSelect").set("labelAttr", "name");
  registry.byId("DayOffDatesSelect").setStore(calendarStoreAdapter);
 
  // -----------------------------------------------
  // crewMemberStore
  // -----------------------------------------------
  var crewMemberStore = new TrackableMemory({
    Model: CrewMemberModel,
    idProperty: "position",
  });

  crewMemberStore.on('add', function(event){
    SVG_drawCrewMember(event.target);
  });
  
  crewMemberStore.on('update', function(event){
    var item = svg.getElementById(event.target.get('ident'));
    
    item.parentNode.removeChild(item);

    SVG_drawCrewMember(event.target);
  });

  crewMemberStore.on('delete', function(event){
    var item = svg.getElementById(event.target.get('ident'));
    
    item.parentNode.removeChild(item);
  });

  var crewMemberStoreAdapter = new DstoreAdapter(crewMemberStore);
  registry.byId("DayOffCrewMemberSelect").set("store", crewMemberStoreAdapter);
  registry.byId("TrainingCrewMemberSelect").set("store", crewMemberStoreAdapter);


  // -----------------------------------------------
  // activityStore
  // -----------------------------------------------
  var activityStore = new TrackableMemory({
    Model: ActivityModel,
    idProperty: "position",
  });

  activityStore.on('add', function(event){
    console.log("activity store add");
    console.log(event.target);
    var line = crewMemberStore.getSync(event.target.get('cmPosition'));
    console.log(line);

    SVG_drawActivity(event.target, line);
  });

  activityStore.on('update', function(event){
    var item = svg.getElementById(event.target.get('ident'));
    
    item.parentNode.removeChild(item);
    
    var line = crewMemberStore.getSync(event.target.get('cmPosition'));

    SVG_drawActivity(event.target, line);
  });

  activityStore.on('delete', function(event){
    var item = svg.getElementById(event.target.get('ident'));
    
    item.parentNode.removeChild(item);
  });

  // -----------------------------------------------
  // stationStore
  // -----------------------------------------------
  var stationStore = new Memory({
    Model: StationModel,
    idProperty: "id",
  });

  // ===============================================
  // LOADING STORES FROM SVG
  // ===============================================
  function LoadStationStore(){
    var rootStationStoreChildren = svg.getElementsByTagName("station");

    for(var i = 0; i < rootStationStoreChildren.length; i ++){
      var obj = rootStationStoreChildren[i];

      stationStore.addSync({
        id: obj.getAttribute('id'),
        code: obj.getElementsByTagName('code')[0].textContent,
        name: obj.getElementsByTagName('name')[0].textContent,
        dstShift: obj.getElementsByTagName('dst-shift')[0].textContent,
        dstStartLst: obj.getElementsByTagName('dst-start-lst')[0].textContent,
        dstEndLst: obj.getElementsByTagName('dst-end-lst')[0].textContent,
        utcOffset: obj.getElementsByTagName('utc-offset')[0].textContent,
      });
    }
  }

  // load data about stations.
  LoadStationStore();

  var stationStoreAdapter = new DstoreAdapter(stationStore);
  registry.byId("CalendarStation").set("store", stationStoreAdapter);

  // ===============================================
  // EVENTS on dijit
  // ===============================================
  
  // -----------------------------------------------
  // Show/Hide dialog
  // -----------------------------------------------
  registry.byId("SHCoordinates").on("change", function(isChecked){
    svg.getElementById("coordinateX").setAttribute("display", isChecked ? "block" : "none");
    svg.getElementById("coordinateY").setAttribute("display", isChecked ? "block" : "none");
  }, true);
  
  registry.byId("SHCalendarHours").on("change", function(isChecked){
    var divs = svg.getElementsByClassName('hour_label');

    for (var i = 0; i < divs.length; i++) {
      divs[i].setAttribute("display", isChecked ? "block" : "none");
    }
  }, true);
  
  registry.byId("SHCalendarDayX").on("change", function(isChecked){
    var divs = svg.getElementsByClassName('relative');

    for (var i = 0; i < divs.length; i++) {
      divs[i].setAttribute("display", isChecked ? "block" : "none");
    }
  }, true);
  
  registry.byId("SHCalendarDayYYYYMMDD").on("change", function(isChecked){
    var divs = svg.getElementsByClassName('yyyymmdd');

    for (var i = 0; i < divs.length; i++) {
      divs[i].setAttribute("display", isChecked ? "block" : "none");
    }
  }, true);

  registry.byId("SHCalendarDayBars").on("change", function(isChecked){
    var divs = svg.getElementsByClassName('day_bar');

    for (var i = 0; i < divs.length; i++) {
      divs[i].setAttribute("display", isChecked ? "block" : "none");
    }
  }, true);

  registry.byId("SHCalendarHourBars").on("change", function(isChecked){
    var divs = svg.getElementsByClassName('hour_bar');
    console.log("je detecte le clic");

    for (var i = 0; i < divs.length; i++) {
      console.log("je change");
      divs[i].setAttribute("display", isChecked ? "block" : "none");
    }
  }, true);




  // -----------------------------------------------
  // Save file dialog
  // -----------------------------------------------
  registry.byId("SaveFile").on("click", function(){
    var a           = document.createElement('a');
    var contentType = 'data:application/octet-stream,';

    //get svg source.
    var serializer = new XMLSerializer();
    var source = serializer.serializeToString(svg);

    var uriContent  = contentType + encodeURIComponent(source);

    a.setAttribute('href', uriContent);
    a.setAttribute('download', registry.byId("filename").value);

    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    SaveFileDialog.hide();
  }, true);

  // -----------------------------------------------
  // Calendar range set up dialog
  // -----------------------------------------------
  registry.byId("CalendarStart").on("change", function(){
    registry.byId("CalendarEnd").constraints.min = date.add(this.get("value"), "day", 1);

    registry.byId("TrainingStartDate").constraints.min = this.get("value");
  }, true);
  
  registry.byId("CalendarEnd").on("change", function(){
    var maxDate = date.add(this.get("value"), "day", -1);

    registry.byId("CalendarStart").constraints.max = maxDate;

    registry.byId("TrainingStartDate").constraints.max = maxDate;
  }, true);

  registry.byId("SetCalendar").on("click", function(){
    var start = registry.byId("CalendarStart");
    var end   = registry.byId("CalendarEnd");
    
    var key = registry.byId("CalendarStation").get('value');

    if( start.get("value") != null && end.get("value") != null ) {
      SetCalendarDialog.hide();

      var range = date.difference(start.get("value"), end.get("value"), "day");
      var mydate = start.get("value");

      var intro = svg.getElementById('intro');
      if(intro){
        intro.parentNode.removeChild(intro);
      } 

      calendarStore.fetch().then(function (users){
        for (var i = users.length - 1; i >= 0; i--) {
          calendarStore.remove(users[i].position);
        }
      });        
      for(i = 0; i < range; i++) {
        calendarStore.addSync({
          name: mydate.toISOString().substring(0, 10),
          relative: i,
          position: i
        });

        mydate = date.add(mydate, "day", 1); 
      }


      var bars = svg.getElementById("crewmember_bar");
      bars.setAttribute("transform", "scale(" + range * 1440 + ",1)");

      // enabled some menu items.
      registry.byId("FileSaveMenu").set('disabled', false);
      registry.byId("CalendarSetStartPeriodsMenu").set('disabled', false);
      registry.byId("BusinessObjectMenu").set('disabled', false);
      registry.byId("GraphOptionMenu").set('disabled', false);
      registry.byId("HighlightsMenu").set('disabled', false);
    }
  });
  
  // Redraw start periods
  registry.byId("SetStartPeriods").on("click", function(){
    var newStarts = registry.byId("CalendarStartPeriods").value;

    if(newStarts.length > 0 ){
      calendarStore.forEach(function(item){
        item.set('relative', item.get('position') - newStarts[0]);
        calendarStore.put(item);
      });
    }

    newStarts.forEach(function(position){
      var item = calendarStore.getSync(position);

      var day = svg.getElementById("bar_" + item.get('ident'));
      day.setAttribute('class', 'start_period');
    }); 
    
    SetStartPeriodsDialog.hide();
  });

  // -----------------------------------------------
  // Create Crewmember dialog
  // -----------------------------------------------
  registry.byId("CreateCrewMember").on("click", function(){
    var coordY = 100;
    var pos = 0;

    // Compute the position and Y coordinate of the new crewmember based on 
    // existing data.
    crewMemberStore.sort('position').forEach(function(item){
      pos += 1;
      coordY += item.get('height');
    }); 

    // Add the new crew in the store. Event will trigger the drawing.
    crewMemberStore.addSync({
      name: registry.byId("CrewMemberName").get('value'),
      birthdate: registry.byId("CrewMemberBirthDate").get('value').toISOString().substring(0, 10),
      position: pos,
      y:coordY,
      height:200,
    });

    coordY += 200;
    var bars = svg.getElementById("calendar_bar");
    bars.setAttribute("transform", "scale(1," + coordY + ")");

    CreateCrewMemberDialog.hide();
  });


  // -----------------------------------------------
  // Create Day Off dialog
  // -----------------------------------------------
  registry.byId("CreateDayOff").on("click", function(){
    console.log("createdayoffform.validate");
    if( !registry.byId("CreateDayOffForm").validate() ){
      return;
    }
    
    var pos = 0;

    // Compute the position and Y coordinate of the new crewmember based on 
    // existing data.
    activityStore.forEach(function(item){
      pos += 1;
    }); 

    console.log("DayOffDatesSelect :");
    console.log(registry.byId("DayOffDatesSelect").isValid());
    console.log(registry.byId("DayOffDatesSelect"));
    var days = registry.byId("DayOffDatesSelect").value; 

    days.forEach(function(day){
      activityStore.addSync({
        name: "DO",
        type: "DO",
        position: pos,
        cmPosition: registry.byId("DayOffCrewMemberSelect").get('value'),
        x: day * 1440,
        width: 1440,
        tp: 0,
        resta: 0,
        restb: 0,
      });
      pos += 1;
    });

    CreateDayOffDialog.hide();
  });

  // -----------------------------------------------
  // Create Training dialog
  // -----------------------------------------------

  registry.byId("TrainingStartDate").on("click,change", function(){
    if(   registry.byId("TrainingStartTime").get("value") != null 
       && registry.byId("TrainingStartDate").get("value") != null ){
      registry.byId("TrainingDurationHour").readOnly = false;
      registry.byId("TrainingDurationHour").set("value", 0);
      registry.byId("TrainingDurationMinute").readOnly = false;
      registry.byId("TrainingDurationMinute").set("value", 0);

      UpdateEndDateTime("Training");
    }
  });

  registry.byId("TrainingStartTime").on("click,change", function(){
    if(   registry.byId("TrainingStartTime").get("value") != null 
       && registry.byId("TrainingStartDate").get("value") != null ){
      registry.byId("TrainingDurationHour").readOnly = false;
      registry.byId("TrainingDurationHour").set("value", 0);
      registry.byId("TrainingDurationMinute").readOnly = false;
      registry.byId("TrainingDurationMinute").set("value", 0);
      
      UpdateEndDateTime("Training");
    }
  });

  registry.byId("TrainingDurationHour").on("click,change", function(){
    UpdateEndDateTime("Training");
  });
  
  registry.byId("TrainingDurationMinute").on("click,change", function(){
    UpdateEndDateTime("Training");
  });

  registry.byId("CreateTraining").on("click", function(){
    var pos = 0;

    // Compute the position and Y coordinate of the new crewmember based on 
    // existing data.
    activityStore.forEach(function(item){
      pos += 1;
    }); 

    var startCalendar = registry.byId("CalendarStart").get("value");
    var startDateTraining = registry.byId("TrainingStartDate").get("value");
    var startTimeTraining = registry.byId("TrainingStartTime").get("value");

    activityStore.addSync({
      name: registry.byId("TrainingName").get("value"),
      type: "TRN",
      position: pos,
      cmPosition: registry.byId("TrainingCrewMemberSelect").get('value'),
      x: date.difference(startCalendar, startDateTraining, "day") * 1440 + startTimeTraining.getHours() * 60 + startTimeTraining.getMinutes(),
      width: registry.byId("TrainingDurationHour").get('value') * 60 + registry.byId("TrainingDurationMinute").get('value'),
      tp: registry.byId("TrainingTransportationTime").checked ? registry.byId("TransportationTimeDuration").get('value') : 0,
      resta: registry.byId("TrainingRestAfterH").get('value') * 60 + registry.byId("TrainingRestAfterM").get('value'),
      restb: registry.byId("TrainingRestBeforeH").get('value') * 60 + registry.byId("TrainingRestBeforeM").get('value'),
    });

    CreateTrainingDialog.hide();
  });

   
  // console.log(FixedTimeZone.getAllZones());
  console.log(moment().format('LLLL'));
  //console.log(moment.tz.names());
});
  </script>

</head>
<body class="claro">
  
  <div data-dojo-type="dijit/MenuBar" id="navMenu" style="margin-bottom: 8px;">
    <div data-dojo-type="dijit/PopupMenuBarItem">
      <span>File</span>
      <div data-dojo-type="dijit/DropDownMenu" id="fileMenu">
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Load SVG file</div>
        <div id="FileSaveMenu" data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){SaveFileDialog.show();}">Save SVG file</div>
      </div>
    </div>
    <div data-dojo-type="dijit/PopupMenuBarItem">
      <span>Calendar</span>
      <div data-dojo-type="dijit/DropDownMenu" id="calendarMenu">
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="onClick:function(){SetCalendarDialog.show();}">Set [Start, End[</div>
        <div id="CalendarSetStartPeriodsMenu" data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){SetStartPeriodsDialog.show();}">Set start period(s)</div>
      </div>
    </div>
    <div id="BusinessObjectMenu" data-dojo-type="dijit/PopupMenuBarItem" data-dojo-props="disabled:true">
      <span>Business objects</span>
      <div data-dojo-type="dijit/DropDownMenu" id="businessObjectMenu">
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="onClick:function(){ShowConstantsDialog.show();}">Show constants</div>
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="onClick:function(){CreateCrewMemberDialog.show();}">Create crewmember</div>
        <div data-dojo-type="dijit/PopupMenuItem">
          <span>Create activity</span>
          <div data-dojo-type="dijit/DropDownMenu" id="submenu2">
            <div data-dojo-type="dijit/MenuItem" data-dojo-props="onClick:function(){CreateDayOffDialog.show();}">Day off</div>
            <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Trip</div>
            <div data-dojo-type="dijit/MenuItem" data-dojo-props="onClick:function(){CreateTrainingDialog.show();}">Training</div>
            <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Other activity</div>
          </div>
        </div>
      </div>
    </div>
    <div id="GraphOptionMenu" data-dojo-type="dijit/PopupMenuBarItem" data-dojo-props="disabled:true">
      <span>Graph options</span>
      <div data-dojo-type="dijit/DropDownMenu" id="graphOptionMenu">
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="onClick:function(){ShowHideDialog.show();}">Calendar Date/Hours</div>
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Activities</div>
      </div>
    </div>
    <div id="HighlightsMenu" data-dojo-type="dijit/PopupMenuBarItem" data-dojo-props="disabled:true">
      <span>Highlights</span>
      <div data-dojo-type="dijit/DropDownMenu" id="highlightsMenu">
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Specific date(s)</div>
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Distance</div>
        <div data-dojo-type="dijit/MenuItem" data-dojo-props="disabled:true, onClick:function(){alert('not yet available');}">Window</div>
      </div>
    </div>

  </div>


  <!-- SVG code -->
  <object id="graph" type="image/svg+xml" data="gantt.svg" width="100%">
    Sorry, your browser does not support SVG.
  </object>
  
  <div data-dojo-type="dijit/Dialog" data-dojo-id="CreateTrainingDialog" title="Create training" style="display: none;" data-dojo-props="onHide: function(){CreateTrainingForm.reset();}" >
    <div data-dojo-type="dijit/form/Form" id="CreateTrainingForm" data-dojo-id="CreateTrainingForm" encType="multipart/form-data" action="" method="">
      <table class="dijitDialogPaneContentArea">
        <tr>
          <td><label for="name">Name</label></td>
          <td><input data-dojo-type="dijit/form/TextBox" name="name" id="TrainingName" required="true"></td>
        </tr>
        <tr>
          <td><label for="TrnCm">Crew member</label></td>
          <td><select data-dojo-type="dijit/form/FilteringSelect" name="TrnCm" id="TrainingCrewMemberSelect" required="true"></td>
        </tr>
        <tr>
          <td><label for="transportationtime">Transportation time apply</label></td>
          <td><input data-dojo-type="dijit/form/CheckBox" name="transportationtime" id="TrainingTransportationTime" value="true" required="true"></td>
        </tr>
        <tr>
          <td><label for="restbefore">Rest before</label></td>
          <td>
            <input class="durationHour" data-dojo-type="dijit/form/NumberSpinner" name="restbefore" id="TrainingRestBeforeH" value="0" data-dojo-props="constraints:{min:0}" required="true">
            <input class="durationMinute" data-dojo-type="dijit/form/NumberSpinner" name="restbefore" id="TrainingRestBeforeM" value="0" data-dojo-props="constraints:{min:0,max:59}" required="true">
          </td>
        </tr>
        <tr>
          <td><label for="start">Start date time</label></td>
          <td class="datetime">
            <input id="TrainingStartDate" name="start" type="date" data-dojo-type="dijit/form/DateTextBox" data-dojo-props="constraints:{  datePattern: 'yyyy-MM-dd'}, placeHolder:'yyyy-mm-dd'"/>
            <input id="TrainingStartTime" type="text" data-dojo-type="dijit/form/TimeTextBox" data-dojo-props="constraints:{  timePattern: 'HH:mm'}, placeHolder:'00:00'"/>
          </td>
        </tr>
        <tr>
          <td><label for="duration">Duration</label></td>
          <td>
            <input id="TrainingDurationHour"   class="durationHour" data-dojo-type="dijit/form/NumberSpinner" name="duration" data-dojo-props="constraints:{min:0,max:999}, placeHolder:'hhh'" required="true" readonly="true">
            <input id="TrainingDurationMinute" class="durationMinute" data-dojo-type="dijit/form/NumberSpinner" name="duration" data-dojo-props="constraints:{min:0,max:59}, placeHolder:'mm'" required="true" readonly="true">
          </td>
        </tr>
        <tr>
          <td><label for="end">End date time</label></td>
          <td class="datetime">
            <input id="TrainingEndDate" name="start" type="date" data-dojo-type="dijit/form/DateTextBox" data-dojo-props="constraints:{  datePattern: 'yyyy-MM-dd'}, placeHolder:'yyyy-mm-dd'" readonly="true" disabled="true" />
            <input id="TrainingEndTime" type="text" data-dojo-type="dijit/form/TimeTextBox" data-dojo-props="constraints:{  timePattern: 'HH:mm'}, placeHolder:'00:00'" readonly="true" disabled="true" />
          </td>
        </tr>
        <tr>
          <td><label for="restafter">Rest after</label></td>
          <td>
            <input class="durationHour" data-dojo-type="dijit/form/NumberSpinner" name="restafter" id="TrainingRestAfterH" value="0" data-dojo-props="constraints:{min:0}" required="true">
            <input class="durationMinute" data-dojo-type="dijit/form/NumberSpinner" name="restafter" id="TrainingRestAfterM" value="0" data-dojo-props="constraints:{min:0,max:59}" required="true">
          </td>
        </tr>
      </table>

      <div class="dijitDialogPaneActionBar">
        <button data-dojo-type="dijit/form/Button" type="button" id="CreateTraining">Create</button>
      </div>
    </div>
  </div>




  <div data-dojo-type="dijit/Dialog" data-dojo-id="ShowHideDialog" title="Show/hide SVG items" style="display: none;">
    <table class="dijitDialogPaneContentArea">
      <tr>
        <td><label for="SHCoordinates">Show coordinates X and Y</label></td>
        <td><input type="checkbox" data-dojo-type="dijit/form/CheckBox" name="SHCoordinates" id="SHCoordinates" checked></td>
      </tr>
      <tr>
        <td><label for="SHCalendarHours">Show calendar hour label</label></td>
        <td><input type="checkbox" data-dojo-type="dijit/form/CheckBox" name="SHCalendarHours" id="SHCalendarHours" checked></td>
      </tr>
      <tr>
        <td><label for="SHCalendarHourBars">Show calendar hour bars</label></td>
        <td><input type="checkbox" data-dojo-type="dijit/form/CheckBox" name="SHCalendarHourBars" id="SHCalendarHourBars" checked></td>
      </tr>
      <tr>
        <td><label for="SHCalendarDayX">Show calendar Day X</label></td>
        <td><input type="checkbox" data-dojo-type="dijit/form/CheckBox" name="SHCalendarDayX" id="SHCalendarDayX" checked></td>
      </tr>
      <tr>
        <td><label for="SHCalendarDayYYYYMMDD">Show calendar day YYYY-MM-DD</label></td>
        <td><input type="checkbox" data-dojo-type="dijit/form/CheckBox" name="SHCalendarDayYYYYMMDD" id="SHCalendarDayYYYYMMDD" checked></td>
      </tr>
      <tr>
        <td><label for="SHCalendarDayBars">Show calendar day bars</label></td>
        <td><input type="checkbox" data-dojo-type="dijit/form/CheckBox" name="SHCalendarDayBars" id="SHCalendarDayBars" checked></td>
      </tr>
    </table>

    <div class="dijitDialogPaneActionBar">
      <button data-dojo-type="dijit/form/Button" type="button" data-dojo-props="onClick:function(){ShowHideDialog.hide();}">Close</button>
    </div>
  </div>


  <div data-dojo-type="dijit/Dialog" data-dojo-id="SaveFileDialog" title="Save SVG graph as a file" style="display: none;">
    <table class="dijitDialogPaneContentArea">
      <tr>
        <td><label for="filename">Filename:</label></td>
        <td><input data-dojo-type="dijit/form/TextBox" name="filename" id="filename" value=".svg" required="true"></td>
      </tr>
    </table>

    <div class="dijitDialogPaneActionBar">
      <button data-dojo-type="dijit/form/Button" type="button" id="SaveFile">Save file</button>
    </div>
  </div>


  <div data-dojo-type="dijit/Dialog" data-dojo-id="SetCalendarDialog" title="Set calendar" style="display: none;">
    <table class="dijitDialogPaneContentArea">
      <tr>
        <td><label for="station">Station</label></td>
        <td><input data-dojo-type="dijit/form/FilteringSelect" name="station" id="CalendarStation" required="true"></td>
      </tr>
      <tr>
        <td><label for="start">Start date</label></td>
        <td class="datetime"><input data-dojo-type="dijit/form/DateTextBox" name="start" id="CalendarStart" required="true" data-dojo-props="constraints:{  datePattern: 'yyyy-MM-dd'}, placeHolder:'yyyy-mm-dd'"></td>
      </tr>
      <tr>
        <td><label for="end">End date (excluded)</label></td>
        <td class="datetime"><input data-dojo-type="dijit/form/DateTextBox" name="end" id="CalendarEnd" required="true" data-dojo-props="constraints:{  datePattern: 'yyyy-MM-dd'}, placeHolder:'yyyy-mm-dd'"></td>
      </tr>
    </table>

    <div class="dijitDialogPaneActionBar">
      <button data-dojo-type="dijit/form/Button" type="button" id="SetCalendar">Set</button>
    </div>
  </div>



  <div data-dojo-type="dijit/Dialog" data-dojo-id="SetStartPeriodsDialog" title="Set start period(s)" style="display: none;">
    <table class="dijitDialogPaneContentArea">
      <tr>
        <td><label for="start">Start period date(s)</label></td>
        <td><input multiple="true" data-dojo-type="dojox/form/CheckedMultiSelect" name="start" id="CalendarStartPeriods"></td>
      </tr>
    </table>

    <div class="dijitDialogPaneActionBar">
      <button data-dojo-type="dijit/form/Button" type="button" id="SetStartPeriods">Set</button>
    </div>
  </div>



  <div data-dojo-type="dijit/Dialog" data-dojo-id="CreateDayOffDialog" title="Create day off" style="display: none;" data-dojo-props="onHide: function(){CreateDayOffForm.reset();}" >
    <div data-dojo-type="dijit/form/Form" id="CreateDayOffForm" data-dojo-id="CreateDayOffForm" encType="multipart/form-data" action="" method="">
      <table class="dijitDialogPaneContentArea">
        <tr>
          <td><label for="crewmemeber">Crew member</label></td>
          <td><select data-dojo-type="dijit/form/FilteringSelect" name="crewmember" id="DayOffCrewMemberSelect" required="true"></td>
        </tr>
        <tr>
          <td><label for="start">date(s)</label></td>
          <td><select multiple="true" data-dojo-type="dojox/form/FixedCheckedMultiSelect" name="start" id="DayOffDatesSelect" required="true"></td>
        </tr>
      </table>

      <div class="dijitDialogPaneActionBar">
        <button data-dojo-type="dijit/form/Button" type="button" id="CreateDayOff">Create</button>
      </div>
    </div>
  </div>



  <div data-dojo-type="dijit/Dialog" data-dojo-id="CreateCrewMemberDialog" title="Create crew member" style="display: none;" data-dojo-props="onHide: function(){CreateCrewMemberForm.reset();}" >
    <div data-dojo-type="dijit/form/Form" id="CreateCrewMemberForm" data-dojo-id="CreateCrewMemberForm" encType="multipart/form-data" action="" method="">
      <table class="dijitDialogPaneContentArea">
        <tr>
          <td><label for="name">Name</label></td>
          <td><input data-dojo-type="dijit/form/TextBox" name="name" id="CrewMemberName" required="true"></td>
        </tr>
        <tr>
          <td><label for="start">Birth date</label></td>
          <td class="datetime"><input data-dojo-type="dijit/form/DateTextBox" name="day" id="CrewMemberBirthDate" required="true"  data-dojo-props="constraints:{  datePattern: 'yyyy-MM-dd'}, placeHolder:'yyyy-mm-dd'"   ></td>
        </tr>
      </table>


      <div class="dijitDialogPaneActionBar">
        <button data-dojo-type="dijit/form/Button" type="button" id="CreateCrewMember">Create</button>
      </div>
    </div>
  </div>


  <div data-dojo-type="dijit/Dialog" data-dojo-id="ShowConstantsDialog" title="Set constants" style="display: none;">
    <table class="dijitDialogPaneContentArea">
      <tr>
        <td><label for="transportationtime">Transportation time duration (in minutes)</label></td>
        <td><input data-dojo-type="dijit/form/NumberTextBox" name="transportationtime" id="TransportationTimeDuration" value="0" data-dojo-props="constraints:{min:0, places:0}" required="true" style="width: 5em;"></td>
      </tr>
    </table>

    <div class="dijitDialogPaneActionBar">
      <button data-dojo-type="dijit/form/Button" type="button" data-dojo-props="onClick:function(){ShowConstantsDialog.hide();}">Close</button>
    </div>
  </div>


</html>
